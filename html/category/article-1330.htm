<!DOCTYPE html>
<html lang="zh-CN">

<head>
        <link rel="canonical" href="https://myanmaraddress.github.io/html/category/article-1330.htm" />
    <title>avframe转byte数组_Spring Boot图片文件转Base64 - Myanmar Address</title>
        <link rel="icon" href="/assets/addons/xcblog/img/myanmaraddress/favicon.ico" type="image/x-icon"/>
    <link href="/assets/addons/xcblog/css/myanmaraddress/bootstrap.css" rel="stylesheet" type="text/css" media="all">
    <!--theme-style-->
    <link href="/assets/addons/xcblog/css/myanmaraddress/style.css" rel="stylesheet" type="text/css" media="all">
    <!--//theme-style-->
    <link href="/assets/addons/xcblog/css/myanmaraddress/popuo-box.css" rel="stylesheet" type="text/css" media="all" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- script -->
    <script src="/assets/addons/xcblog/js/frontend/myanmaraddress/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/addons/xcblog/js/frontend/myanmaraddress/move-top.js"></script>
    <script type="text/javascript" src="/assets/addons/xcblog/js/frontend/myanmaraddress/easing.js"></script>
    <link type="text/css" rel="stylesheet" href="/assets/addons/xcblog/css/myanmaraddress/jquery.mmenu.all.css" />
    <script type="text/javascript">
    $(window).load(function() {
        $('div.description').each(function() {
            $(this).css('display', 'block');
        });

        $('div.content-top-grid').hover(function() {
            $(this).children('.description').stop().fadeTo(500, 1);
        }, function() {
            $(this).children('.description').stop().fadeTo(500, 0);
        });

    });
    </script>
    <script type="text/javascript" src="/assets/addons/xcblog/js/frontend/myanmaraddress/jquery.mmenu.js"></script>
    <script type="text/javascript">
    //	The menu on the left
    $(function() {
        $('nav#menu-left').mmenu();
    });
    </script>
    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e4890e777e20237a4f5a0c3a6a01049c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3332997411212854"
     crossorigin="anonymous"></script>
</head>

<body>
    <!--header-->
    <div class="header">
        <a class="navicon" href="#menu-left"> </a>
        <div class="container">
            <div class="header-matter">
                <h1>avframe转byte数组_Spring Boot图片文件转Base64</h1>
                <p>
                    <a href="/">首页</a> / <a href="/html/category/">文章分类</a> / 正文
                </p>
            </div>
        </div>
                <nav id="menu-left">
            <ul>
                                <li><a href="/">首页</a></li>
                                <li><a href="/html/category/">文章分类</a></li>
                                <li>
                    <a href="#">关于</a>
                </li>
                <li>
                    <a href="#">联系</a>
                </li>
            </ul>
        </nav>
        <script type="text/javascript">
        jQuery(document).ready(function($) {
            $(".scroll").click(function(event) {
                event.preventDefault();
                $('html,body').animate({ scrollTop: $(this.hash).offset().top }, 1000);
            });
        });
        </script>
    </div>
    <div class="clearfix"> </div>
    <!--//header-->
    <!--content-->
    <div class="content">
        <!--our-news-->
        <div class="our-news" id="news">
            <div class="container">
                <div class="row">
                    <div class="col-md-9">
                        <div class="news">
                              				  				  				<div id="content_views" class="htmledit_views"> <div style="font-size:16px;"> <p>我们公司用的云之家作为企业内容的IM通讯工具，那么就经常会涉及通过云之家进行消息推送，这个就有点类似微信了。那么我在推送图文消息的时候，云之家需要我把图片转Base64的格式传过去。</p> <div class="pgc-img"><img decoding="async" src="http://img.555519.xyz/uploads3/20220603/f62e5a6f8960ca9e832f9cfab64ef377.jpg" alt="avframe转byte数组_Spring Boot图片文件转Base64"></div> <p>最开始我傻傻的用在线工具把图片转成Base64然后复制到程序里，当然这肯定是不好的，但是为了测试，就这样做了，然后占了70%的代码行数。正式的话，我们肯定是要借助代码来实现。那么我们需要先获取项目目录下的文件</p> <pre class="has"><code>File file = ResourceUtils.getFile(ResourceUtils.CLASSPATH_URL_PREFIX + "static/warnning.png");</code></pre> <p>然后借助sun.misc.BASE64Decoder把文件转Base64</p> <pre class="has"><code>public static String file2Base64(File file) {        InputStream in = null;        byte[] data = null;        // 读取文件字节数组        try {            in = new FileInputStream(file);            data = new byte[in.available()];            in.read(data);            in.close();        } catch (IOException e) {            e.printStackTrace();        } finally {            try {                in.close();            } catch (IOException e) {                e.printStackTrace();            }        }        // 对字节数组Base64编码        BASE64Encoder encoder = new BASE64Encoder();        // 返回 Base64 编码过的字节数组字符串        return encoder.encode(data);    }</code></pre> <p>在本地一切都没有问题，但是通过jenkins发布到K8S的时候老是出现找不到包的问题，我也就没去深究，后来就用Hutool,这里我引入了Hutool工具包</p> <pre class="has"><code>cn.hutool            hutool-core            5.4.3</code></pre> <p>Hutool的Base64.encode在core这个包里面，所以只需要引入hutool-core即可。 引用非常简单</p> <pre class="has"><code>File file = ResourceUtils.getFile(ResourceUtils.CLASSPATH_URL_PREFIX + "static/warnning.png");String picBase64= cn.hutool.core.codec.Base64.encode(file);</code></pre> <p>但是事情似乎也并没有那么顺利，在本地运行没有问题，项目也是在K8S上运行起来了，但是获取不到文件</p> <pre class="has"><code>java.io.FileNotFoundException: class path resource [static/warnning.png] cannot be resolved to absolute file path because it does not reside in the file system: jar:file:/home/app.jar!/BOOT-INF/classes!/static/warnning.png</code></pre> <div class="pgc-img"><img decoding="async" src="http://img.555519.xyz/uploads3/20220603/ce941acc1877e13a563274fa92aecfaa.jpg" alt="avframe转byte数组_Spring Boot图片文件转Base64"></div> <p>因为打包之后是jar文件，ResourceUtils.getFile无法访问jar中的目录，所以后来采用获取文件流的方式</p> <pre class="has"><code> ClassPathResource resource = new ClassPathResource("static/warnning.png"); String picBase64= cn.hutool.core.codec.Base64.encode(resource.getInputStream());</code></pre> <p>Hutool这个工具包确实不错，提供很多丰富的工具类，我用得比较多是就是StringUtil和DateUtil等，确实非常方便，大家有兴趣的可以去了解一下</p> <div class="pgc-img"><img decoding="async" src="http://img.555519.xyz/uploads3/20220603/143e0c272286aa5be3ed36c2e2ab2980.jpg" alt="avframe转byte数组_Spring Boot图片文件转Base64"></div> <p>现在各种工具类库以及Spring Boot的Starter，它们封装了许多实用的组件和工具类，为我们的开发提高了效率，这样有利有弊，当然，如果仅仅是为了解决工作中的问题，我可以借助更多简便的类库来完成，但是，我需要去了解其背后的原理和实现机制，不然，我们的能力仅仅停留在使用层面，这对我们来说是非常不利的。我们要知其然，更要知其所以然，开源的类库众多，我们需要花心思去学习它的源代码、学习大神们编程思想。</p> </div> </div> 			                        </div>

                        <div class="col-md-12 mt-5">
                                                        <p>上一个：<a href="/html/category/article-1329.htm">Visual Studio快捷键汇总_实用技巧_</a></p>
                                                        <p>下一个：<a href="/html/category/article-1339.htm">分享MySQL生产库内存异常增高的排查过程_Mysql_</a></p>
                                                    </div>

                                            </div>
                    <div class="col-md-3">
                    	<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">热门文章</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2"><a href="/html/category/article-1329.htm" title="Visual Studio快捷键汇总_实用技巧_">Visual Studio快捷键汇总_实用技巧_</a></li>
                        <li class="py-2"><a href="/html/category/article-1934.htm" title="朴素贝叶斯算法详解">朴素贝叶斯算法详解</a></li>
                        <li class="py-2"><a href="/html/category/article-1283.htm" title="Python 的math 模块">Python 的math 模块</a></li>
                        <li class="py-2"><a href="/html/category/article-1304.htm" title="网络协议之:socket协议详解之Socket和Stream Socket">网络协议之:socket协议详解之Socket和Stream Socket</a></li>
                        <li class="py-2"><a href="/html/category/article-1340.htm" title="请说一下你对分布式锁的理解，以及分布式锁的实现">请说一下你对分布式锁的理解，以及分布式锁的实现</a></li>
                        <li class="py-2"><a href="/html/category/article-1339.htm" title="分享MySQL生产库内存异常增高的排查过程_Mysql_">分享MySQL生产库内存异常增高的排查过程_Mysql_</a></li>
                        <li class="py-2"><a href="/html/category/article-1313.htm" title="二叉树与堆">二叉树与堆</a></li>
                        <li class="py-2"><a href="/html/category/article-1309.htm" title="sqlserver 中使用sqlcmd 执行几百M的.sql文件">sqlserver 中使用sqlcmd 执行几百M的.sql文件</a></li>
                        <li class="py-2"><a href="/html/category/article-1349.htm" title="父组件调用子组件的方法-子组件向父组件传值">父组件调用子组件的方法-子组件向父组件传值</a></li>
                        <li class="py-2"><a href="/html/category/article-1317.htm" title="JSON  传输数据出现415错误 Content type &#8216;application/xml;charset=UTF-8&#8217; not supported">JSON  传输数据出现415错误 Content type &#8216;application/xml;charset=UTF-8&#8217; not supported</a></li>
                    </ul>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">归纳</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">46</span> <a href="/html/date/2024-06/" title="2024-06 归档">2024-06</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-05/" title="2024-05 归档">2024-05</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">60</span> <a href="/html/date/2024-04/" title="2024-04 归档">2024-04</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">62</span> <a href="/html/date/2024-03/" title="2024-03 归档">2024-03</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">50</span> <a href="/html/date/2024-02/" title="2024-02 归档">2024-02</a></h4>
            </li>
                    </ul>
    </div>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--//content-->
        <!--footer-->
    <div class="footer">
        <div class="container">
            <p>
                Myanmar Address 版权所有
                <br />
                Powered by WordPress
            </p>
        </div>
    </div>
    <script>
    $(function() {
        $('.js_to').click(function(){
            var url = $(this).data('url');
            var code = $(this).data('code');
            url += code;

            window.open(url);
        })
    });
    </script>
</body>

</html>